
# 🧬 データモデル設計（budget_book）

## 🎯 目的

本ドキュメントでは、各ドメインオブジェクト（Entry, Debt, Method）について、ZodとPrismaで表現可能なレベルまで具体的な構造と制約を定義する。  
これにより、アプリケーション実装への橋渡しと、正確なバリデーション・保存・取得処理の土台を構築する。

---

## 📘 Entry（収支記録）

| フィールド名 | 型 | 必須 | 説明 |
|--------------|----|------|------|
| `id` | string (UUID) | ✅ | エントリの一意識別子 |
| `type` | "収入"｜"支出"｜"借入"｜"貸出"｜"返済" | ✅ | エントリ種別 |
| `amount` | number | ✅ | 金額（正数、支出時も正の値） |
| `date` | Date | ✅ | 記録日 |
| `category` | string | ✅ | 分類（typeに応じてカテゴリは変化） |
| `methodId` | string | ✅ | 使用した支払手段のID |
| `debtId` | string（nullable） | ❌ | 関連する貸借ID（あれば） |
| `purpose` | string（nullable） | ❌ | 表向きの使途メモ |
| `privatePurpose` | string（nullable） | ❌ | 非公開の使途（内部記録用） |
| `note` | string（nullable） | ❌ | 補足情報など |
| `evidenceNote` | string（nullable） | ❌ | 証憑へのメモやリンクなど |

---

## 📘 Debt（貸借関係）

| フィールド名 | 型 | 必須 | 説明 |
|--------------|----|------|------|
| `id` | string (UUID) | ✅ | 貸借の一意識別子 |
| `type` | "借入"｜"貸出" | ✅ | 借りた or 貸した |
| `partner` | string | ✅ | 相手の名前（個人・団体問わず） |
| `startDate` | Date | ✅ | 開始日 |
| `amount` | number | ✅ | 総額（初期） |
| `note` | string（nullable） | ❌ | 備考・条件など |
| `repaidAmount` | number | ✅ | 返済済み金額（自動加算） |
| `completed` | boolean | ✅ | 完済済かどうか |

---

## 📘 Method（支払い手段）

| フィールド名 | 型 | 必須 | 説明 |
|--------------|----|------|------|
| `id` | string (UUID) | ✅ | 手段の一意識別子 |
| `name` | string | ✅ | 表示名（例：現金、三井住友口座、Suicaなど） |
| `type` | "現金"｜"銀行"｜"プリペイド"｜"クレジット"｜"その他" | ✅ | 手段の種別 |
| `initialAmount` | number | ✅ | 初期登録時点の所持金額 |
| `note` | string（nullable） | ❌ | 備考・メモなど |

---

## ✅ 実装上の方針

- すべてのドメインモデルは `Zod` によるバリデーション定義と `Prisma` モデルに対応
- IDは UUID を基本とし、明示的に生成・指定
- null 許容と optional の違いは厳密に区別する
- Prisma では外部キー制約を設けつつ、**循環参照を避ける**
- `Entry` は `Method` に必ず紐づき、`Debt` に任意で紐づく

---

この仕様により、application 層のバリデーション、infrastructure 層の保存処理、UI側の型補完が一貫して整合する。
