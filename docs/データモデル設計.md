# ğŸ§© ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«è¨­è¨ˆï¼ˆbudget_bookï¼‰

---

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€budget_bookã«ãŠã‘ã‚‹ä¸»è¦ãªãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ï¼ˆPrismaãƒ¢ãƒ‡ãƒ«ç›¸å½“ï¼‰ã¨ãã®æ§‹é€ ã€ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€åˆ¶ç´„ã‚’å®šç¾©ã™ã‚‹ã€‚  
å®Ÿè£…ãƒ™ãƒ¼ã‚¹ã§ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æ§‹æˆãƒ»åˆ¶ç´„ãƒ»ä¿å­˜æ§‹é€ ãªã©ã‚’ä¸­å¿ƒã«è¨˜è¿°ã™ã‚‹ã€‚

---

## ğŸ“„ Entryï¼ˆåæ”¯è¨˜éŒ²ï¼‰

åæ”¯ãƒ»å€Ÿå…¥ãƒ»è²¸ä»˜ãƒ»è¿”æ¸ˆãªã©é‡‘éŠ­ã®æµã‚Œã‚’è¨˜éŒ²ã™ã‚‹åŸºæœ¬å˜ä½ã€‚

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å       | å‹       |?  | èª¬æ˜ |
|--------------------|----------|----|------|
| `id`              | string   | âŒ | ä¸»ã‚­ãƒ¼ |
| `type`            | EntryType | âŒ | ç¨®åˆ¥ï¼ˆZod Enumï¼‰ |
| `date`            | DateTime | âŒ | ç™ºç”Ÿæ—¥ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ã‚¿ã‚¤ãƒ ï¼‰ |
| `amount`          | Decimal  | âŒ | é‡‘é¡ï¼ˆæ­£æ•°ï¼‰ |
| `methodId`        | string   | âŒ | æ”¯æ‰•ã„æ‰‹æ®µï¼ˆMethod.idï¼‰ |
| `categoryId`      | string   | âœ… | ã‚«ãƒ†ã‚´ãƒªï¼ˆä»»æ„ã€åæ”¯ç³»ã®ã¿ï¼‰ |
| `purpose`         | string   | âœ… | è¡¨å‘ãã®ä½¿é€”ã€‚è©³ç´°ãªå†…å®¹ã‚ã‚Šã†ã‚‹ |
| `privatePurpose`  | string   | âœ… | éå…¬é–‹ã®å®Ÿéš›ã®ä½¿é€”ã€‚UIéè¡¨ç¤ºãƒ»é›†è¨ˆå¯¾è±¡å¤– |
| `note`            | string   | âœ… | è£œè¶³æƒ…å ±ãƒ»æ–‡è„ˆç”¨ã®è‡ªç”±è¨˜è¿° |
| `evidenceNote`    | string   | âœ… | è¨¼æ†‘æƒ…å ±ã€‚**URIã®å ´åˆã€å¿…ãšã‚¢ãƒ—ãƒªå†…ä¿å­˜ãƒªã‚½ãƒ¼ã‚¹ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹** |
| `debtId`          | string   | âœ… | ç´ã¥ãDebtã®IDï¼ˆè¿”æ¸ˆãƒ»å€Ÿå…¥é–¢é€£ï¼‰ |
| `createdAt`       | DateTime | âŒ | ä½œæˆæ—¥æ™‚ |

---

## ğŸ’³ Debtï¼ˆè²¸å€Ÿç®¡ç†ï¼‰

å€Ÿå…¥ï¼è²¸ä»˜ã®è¨˜éŒ²ã¨ãã®çŠ¶æ…‹ç®¡ç†ã€‚

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å       | å‹       |?  | èª¬æ˜ |
|--------------------|----------|----|------|
| `id`              | string   | âŒ | ä¸»ã‚­ãƒ¼ |
| `type`            | DebtType | âŒ | å€Ÿå…¥ï¼è²¸ä»˜ã®ç¨®åˆ¥ |
| `rootEntryId`     | string   | âŒ | èµ·ç‚¹ã¨ãªã‚‹Entryã®ID |
| `date`            | DateTime | âŒ | ç™ºç”Ÿæ—¥ |
| `amount`          | Decimal  | âŒ | é‡‘é¡ |
| `counterpart`     | string   | âŒ | ç›¸æ‰‹ï¼ˆåå‰ or è­˜åˆ¥å­ï¼‰ |
| `repaidAt`        | DateTime | âœ… | è¿”æ¸ˆå®Œäº†æ—¥ |
| `memo`            | string   | âœ… | å‚™è€ƒæ¬„ï¼ˆè£œè¶³æƒ…å ±ï¼‰ |

---

## ğŸ’° Methodï¼ˆæ”¯æ‰•ã„æ‰‹æ®µï¼‰

æ”¯æ‰•ã„å…ƒãƒ»æ‰‹æ®µï¼ˆç¾é‡‘ã€å£åº§ã€é›»å­ãƒãƒãƒ¼ãªã©ï¼‰ã‚’è¡¨ã™ã€‚

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å       | å‹       |?  | èª¬æ˜ |
|--------------------|----------|----|------|
| `id`              | string   | âŒ | ä¸»ã‚­ãƒ¼ |
| `name`            | string   | âŒ | è¡¨ç¤ºå |
| `initialBalance`  | Decimal  | âœ… | åˆæœŸæ®‹é«˜ï¼ˆä»»æ„ï¼‰ |
| `archived`        | boolean  | âœ… | ä½¿ç”¨åœæ­¢çŠ¶æ…‹ã‹ |

---

## ğŸ”„ Transferï¼ˆæŒ¯æ›¿ï¼‰

æŒ¯æ›¿ã®è¨˜éŒ²ã‚’è¡¨ã™ã€‚

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å       | å‹       |?  | èª¬æ˜ |
|--------------------|----------|----|------|
| `id`              | string   | âŒ | ä¸»ã‚­ãƒ¼ |
| `rootEntryId`     | string   | âŒ | ç´ã¥ãEntryã®ID |
| `fromMethodId`    | string   | âŒ | æŒ¯æ›¿å…ƒã®Method ID |
| `toMethodId`      | string   | âŒ | æŒ¯æ›¿å…ˆã®Method ID |
| `date`            | DateTime | âŒ | æŒ¯æ›¿æ—¥ |
| `note`            | string   | âœ… | å‚™è€ƒæ¬„ |

---

## ğŸ“‚ Categoryï¼ˆã‚«ãƒ†ã‚´ãƒªï¼‰

UIç·¨é›†å¯èƒ½ãªã‚«ãƒ†ã‚´ãƒªç¾¤ï¼ˆæ”¯å‡ºãƒ»åå…¥ã®åˆ†é¡ï¼‰ã€‚

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å       | å‹       |?  | èª¬æ˜ |
|--------------------|----------|----|------|
| `id`              | string   | âŒ | ä¸»ã‚­ãƒ¼ |
| `name`            | string   | âŒ | è¡¨ç¤ºå |
| `type`            | CategoryType | âŒ | ã‚«ãƒ†ã‚´ãƒªç¨®åˆ¥ |

---

## ğŸ“Š Metaãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### EntryTypeMeta

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å       | å‹       |?  | èª¬æ˜ |
|--------------------|----------|----|------|
| `type`            | EntryType | âŒ | ä¸»ã‚­ãƒ¼ |
| `label`           | string   | âŒ | è¡¨ç¤ºãƒ©ãƒ™ãƒ« |
| `description`     | string   | âœ… | èª¬æ˜ |
| `color`           | string   | âœ… | è¡¨ç¤ºè‰² |
| `icon`            | string   | âœ… | ã‚¢ã‚¤ã‚³ãƒ³ |
| `sortOrder`       | int      | âœ… | ä¸¦ã³é † |

---

### DebtTypeMeta

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å       | å‹       |?  | èª¬æ˜ |
|--------------------|----------|----|------|
| `type`            | DebtType | âŒ | ä¸»ã‚­ãƒ¼ |
| `label`           | string   | âŒ | è¡¨ç¤ºãƒ©ãƒ™ãƒ« |
| `description`     | string   | âœ… | èª¬æ˜ |
| `color`           | string   | âœ… | è¡¨ç¤ºè‰² |
| `icon`            | string   | âœ… | ã‚¢ã‚¤ã‚³ãƒ³ |
| `sortOrder`       | int      | âœ… | ä¸¦ã³é † |

---

### CategoryTypeMeta

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å       | å‹       |?  | èª¬æ˜ |
|--------------------|----------|----|------|
| `type`            | CategoryType | âŒ | ä¸»ã‚­ãƒ¼ |
| `label`           | string   | âŒ | è¡¨ç¤ºãƒ©ãƒ™ãƒ« |
| `description`     | string   | âœ… | èª¬æ˜ |
| `color`           | string   | âœ… | è¡¨ç¤ºè‰² |
| `icon`            | string   | âœ… | ã‚¢ã‚¤ã‚³ãƒ³ |
| `sortOrder`       | int      | âœ… | ä¸¦ã³é † |

---

## ğŸ“Œ å‚™è€ƒ

- `evidenceNote` ã«URIã‚’æŒ‡å®šã™ã‚‹å ´åˆã€ãã‚Œã¯ `public/storage/receipt/` ã«ä¿å­˜ã•ã‚ŒãŸã‚¢ãƒ—ãƒªå†…éƒ¨ãƒªã‚½ãƒ¼ã‚¹ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹
- Prismaã«ãŠã„ã¦ã¯ã€å„ãƒ¢ãƒ‡ãƒ«ã« `@@map` / `@relation` / `@default` ãªã©ã‚’é©å®œè¨­å®šã™ã‚‹

---

## ğŸ–¼ ERå›³

ä»¥ä¸‹ã¯ãƒ¢ãƒ‡ãƒ«é–“ã®ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç¤ºã™ERå›³ã§ã‚ã‚‹ã€‚

```mermaid
erDiagram
    Entry {
        string id PK
        EntryType type
        DateTime date
        Decimal amount
        string methodId FK
        string categoryId FK "nullable"
        string purpose "nullable"
        string privatePurpose "nullable"
        string note "nullable"
        string evidenceNote "nullable"
        string debtId FK "nullable"
        DateTime createdAt
    }

    Debt {
        string id PK
        DebtType type
        string rootEntryId FK, UK
        DateTime date
        Decimal amount
        string counterpart
        DateTime repaidAt "nullable"
        string memo "nullable"
    }

    Method {
        string id PK
        string name
        Decimal initialBalance "nullable"
        Boolean archived "nullable"
    }

    Transfer {
        string id PK
        string rootEntryId FK, UK
        string fromMethodId FK
        string toMethodId FK
        DateTime date
        string note "nullable"
    }

    Category {
        string id PK
        string name
        CategoryType type
    }

    EntryTypeMeta {
        EntryType type PK
        string label UK
        string description "nullable"
        string color "nullable"
        string icon "nullable"
        int sortOrder "nullable"
    }

    DebtTypeMeta {
        DebtType type PK
        string label UK
        string description "nullable"
        string color "nullable"
        string icon "nullable"
        int sortOrder "nullable"
    }

    CategoryTypeMeta {
        CategoryType type PK
        string label UK
        string description "nullable"
        string color "nullable"
        string icon "nullable"
        int sortOrder "nullable"
    }

    Entry ||--o{ Method : "methodId"
    Entry ||--o{ Category : "categoryId"
    Entry ||--o{ Debt : "debtId"
    Entry ||--o{ EntryTypeMeta : "type"
    Debt ||--o{ Entry : "rootEntryId"
    Debt ||--o{ DebtTypeMeta : "type"
    Method ||--o{ Entry : "entries"
    Transfer ||--o{ Method : "fromMethodId"
    Transfer ||--o{ Method : "toMethodId"
    Transfer ||--o{ Entry : "rootEntryId"
    Category ||--o{ Entry : "entries"
    Category ||--o{ CategoryTypeMeta : "type"
```

---

ä»¥ä¸ŠãŒç¾æ™‚ç‚¹ã§ã®ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«å®šç¾©ã§ã™ã€‚
