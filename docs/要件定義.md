# 📄 要件定義書（budget_book - Node.js / Next.js / PostgreSQL版）

---

## 🎯 目的

本システムは、個人の収支・貸借・資産状況を直感的かつ継続的に把握することを目的とした、自己管理型の家計簿アプリである。  
スマホでの使用を主軸とし、軽快なUI・型安全なAPI・通知機能・視覚的な資産推移レポートなどを備える。  
また、将来的にはLLMおよび美少女Live2Dコンシェルジュによる生活全体の統合管理を視野に入れ、拡張性を重視した設計とする。

---

## 🔧 機能要件

### ◎ 収支管理

- 収入・支出の登録／修正／削除
- カテゴリ・支払い方法・メモ等の記録

### ◎ 貸借管理

- 借入／貸付の登録・返済記録
- 貸借単位での状態（未返済／完済など）管理
- 返済受取の記録（EntryType: repay_received）
  - 借りた金額が返ってきた場合の管理
- 初期残高の登録（EntryType: initial_balance）
  - Method作成時に残高がある場合の初期記録

### ◎ method（支払い方法）ごとの管理

- method（口座、現金、プリペイドなど）単位での残高計算
- 支払い方法別の使用履歴、資産の推移グラフ表示

### ◎ カテゴリ・methodの編集機能

- カテゴリ／支払い方法の追加・変更・削除（UIからの編集対応）
- アーカイブによる非表示管理（Methodのみ）

### ◎ 資産推移／レポート

- 月次レポート生成（各月の収支まとめ、カテゴリ比率など）
- method別残高推移（週次／月次）
- 全体資産の合計推移（時系列グラフ）

<!--
### ◎ 通知機能

- Googleカレンダー／タスク連携による通知（初期実装）
- 将来的には Web Push 対応も検討
- 通知内容の例：
  - 借入返済日のリマインド
  - 月末に月次レポートが生成されたことの通知
-->

### ◎ 口座間振替（EntryType: transfer）

- 自身のMethod間での金銭移動を記録
- 収支には該当しないが、残高推移に影響する重要な操作
- EntryTypeによって特別扱いされるが、構造的にはEntryで記録される
- 必要に応じて `fromMethod` / `toMethod` の管理を補助モデル化する可能性あり

---

## ⚙️ 非機能要件

- スマホUIを第一級としたPWA対応
- Google連携によるネイティブ通知感の確保（カレンダー／タスク）
- Zod＋TypeScriptによるバリデーション／型安全性の維持
- GAS資産の有効活用（型と処理ロジックの移植・再利用）
- ドメイン層とユースケース層の分離、責務明確化
- セルフホスト対応（Cloudflare Tunnel経由）
- LLM／他ツールとのAPI連携を可能とする構造（将来的構想）

---

## 🧩 技術構成前提

- **フロントエンド**：Next.js + React + Tailwind CSS
- **バックエンド**：Node.js（Express or tRPC）
- **スキーマ管理**：Zod
- **DB**：PostgreSQL
- **通知**：Googleカレンダー／タスク（初期）、Web Push（将来）
- **ホスティング**：セルフホスト（CF Tunnel前提）

---

## 🧪 対象ユーザーとユースケース概要

- **ユーザー**：開発者自身（単一ユーザー）
- **主なユースケース**：
  - スマホから収支を素早く登録
  - 月末にレポートで収支振り返り
  - 支払い方法ごとの資産把握
  - 通知で借入・支払いをリマインド
  - 返済受取・振替・初期残高の記録を行う

---

## 🌌 将来的な展望

- 音声・対話UI（LLM＋TTS＋Live2D）※コンシェルジュアプリ完成後に連携予定
- タスク／予定／健康／生活情報との統合
- マルチデバイス展開（スマホ・PC・ネイティブアプリ）
- マルチユーザー／共有モードへの拡張（任意）

---

以上が本システムの現時点での要件定義である。
