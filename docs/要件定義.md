# ✅ 現在の要件まとめ（2025/03/22時点）

---

## 🧭 プロジェクト情報

| 項目 | 内容 |
| --- | --- |
| プロジェクト名 | `budget_book` |
| 主目的 | 個人の「収支記録（entry）」と「貸借管理（debt）」の統合管理 |
| 開発環境 | Google Sheets + Google Apps Script（TypeScript）開発はVS Code + claspで行う |
| UI要望 | GAS Web Appによるスマホ対応フォーム／ダッシュボード |

---

## 📘 システム構成

### 1. **収支記録シート（entry）**

- 実際のキャッシュフローを記録
- 借入や返済の動きも含めて6種のタイプを扱う
- 貸借の返済記録とは `取引ID` で紐づける

### 📌 収支タイプ（6種）

- 収入
- 支出
- 借入
- 返済
- 貸付
- 返済受取

---

### 2. **貸借管理表（debt）**

- 借入・貸付の基本情報、返済スケジュール、進捗を管理
- 収支記録と `取引ID` で連携
- 分割返済や周期、残高・完済判定も管理

---

## 🧱 技術・設計方針

| 項目 | 方針内容 |
| --- | --- |
| 型管理 | `Entry` / `Debt` 型を定義し、**厳密に型付け管理** |
| データ変更対応 | **マイグレーション機構**で構造変更を管理 |
| 実行トリガー | **イベントドリブン主体**（onOpen, onEdit）＋メニュー実行補助 |
| 通知処理 | 後から追加予定。内容に応じて**定期実行 or 手動 or 編集検出**方式で実装 |
| UI方針 | GAS Web UI（スマホ対応）で操作／確認を可能にする構成を目指す |
| 拡張性 | 将来的に**他自己管理アプリと連携できる構成**にしておく（API連携など） |

---

## 📦 ディレクトリ構成（予定）

```plaintext
コピーする編集する
src/
├── app/              ← イベントハンドラ（onOpen など）
├── domain/
│   ├── entry/        ← Entry型定義、バリデーション、ロジック
│   └── debt/         ← Debt型定義、スケジュール計算、完済チェックなど
├── infrastructure/
│   ├── sheet/        ← シート読み書き
│   ├── notify/       ← 通知処理（LINE/Gmailなど予定）
│   └── ui/           ← Web UI表示（フォーム・ダッシュボード）
├── common/           ← 定数、ログ、ユーティリティ
├── migrations/       ← データ構造更新時の変換処理

```

---

## 🔔 現時点で決まっていない or 今後検討項目

| 項目 | 状況 |
| --- | --- |
| 通知トリガー | どの条件で通知するか（期限前、未完済など）を今後検討 |
| LINEなどの通知方式 | 実装候補（Gmail, LINE Notify, Slack など） |
| 返済周期ロジック | 每月◯日／第n◯曜日などの自動計算方式は今後設計予定 |
| 取引IDの発行方法 | 手入力 or 自動発行（GASで自動生成する可能性あり） |

---

## ✅ 次にやるべきタスク（提案）

| 優先 | タスク |
| --- | --- |
| 🔵 | `Entry` 型（`entryTypes.ts`）の定義 |
| 🔵 | `validateEntry()` の実装 |
| 🔵 | `getEntries()` でシートから読み込む処理 |
| ⚪️ | `Debt` 側の型定義と進捗計算 |
| ⚪️ | `main.ts` からメニューに「収支検証」など登録 |
| ⚪️ | UIプロトタイプ（Webフォーム）の作成 |
