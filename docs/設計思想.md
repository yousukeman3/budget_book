# 📘 `budget_book` 設計思想（ver. Node/Next.js/React, PostgreSQL対応）

---

## 🎯 **目的**

- **自分自身の収支・貸借管理**を、従来のGASベースの資産を最大限活かしながら、最新のWeb技術（Next.js/React/Node.js）に移行して実現する。  
- スマホをはじめとするあらゆるデバイスで、直感的かつ軽快に利用できるUI（PWA／ネイティブ通知含む）を提供する。  
- 支払い方法ごとの金額集計や、将来的なLLM・Live2D美少女コンシェルジュとの統合を視野に入れ、**拡張性と連携性**を重視したシステムとする。

---

## 🧠 **開発スタンスと信条**

- **実用性第一**：  
  現実の生活で「使える」ことを最優先し、無駄な理論よりも現場で役立つ機能を重視する。  
  これまでGASで書いた資産は捨てず、むしろその正しさを証明するために**再利用**する。

- **型安全と再利用の徹底**：  
  TypeScriptとZodによる厳密な型管理・バリデーションを基盤とし、フロントとバックで同一のロジック・型定義を共有する。  
  「バリデーションの二重行政」は排除し、一元管理されたルールで整合性を担保する。

- **責務分離と層の明確化**：  
  UI（Next.js/React）、API（Node.js）、ドメインロジック、インフラ（データアクセス・通知処理）と、各層の責任を明確に分離する。  
  これにより、将来的な機能拡張（LLM連携、Live2Dコンシェルジュなど）も、各層の独立性を保ちつつ容易に統合できる。

- **拡張性と将来性の担保**：  
  初期はシングルユーザー、シンプルなセルフホスト運用としてスタートするが、将来的に複数のAPIやAI機能、外部連携（Google連携、ネイティブ通知など）を統合するための基盤とする。  
  PostgreSQLの採用により、同時アクセスや多様なクエリも安全かつ効率的に処理できる設計とする。

- **UX重視と生活への溶け込み**：  
  スマホ利用がメインとなるため、UIはReactを活用した直感的で軽快な操作感を実現する。  
  Googleカレンダーやタスク連携を活用したリマインド機能、今後追加予定のWeb Pushなど、ネイティブに近いUXを提供し、日常の「使いやすさ」を最重要視する。

---

## 🏗️ **技術構成の前提**

- **フロントエンド**：Next.js（Reactベース）＋Tailwind CSS  
  → スマホ対応PWA、直感的な入力フォームとダッシュボード、将来的なLive2D埋め込みも視野に

- **バックエンド**：Node.js（ExpressまたはtRPC）  
  → APIエンドポイントで、型とバリデーションはZodで一元管理。  
  → すべてのUIや他システムはこのAPIを通してデータアクセスする。

- **データベース**：PostgreSQL  
  → 高い同時アクセス性、整合性、型安全性を活かし、将来的な多システム連携にも対応可能

- **その他**：  
  - 通知はGoogleカレンダー／タスク連携を初期対応とし、Web Pushは将来的に対応予定  
  - 将来的にはLLMとの連携を前提としたAPI設計と、Live2D美少女コンシェルジュによる対話UIへの拡張を計画

---

## 🔧 **設計の具体的指針**

1. **共通型・バリデーションの一元管理**  
   - `Entry`、`Debt`、支払い方法別の集計など、すべてのデータはZodスキーマで検証し、型安全に運用。  
   - フロントとバックで同じ型定義を共有し、重複実装を避ける。

2. **責務分離の徹底**  
   - **ドメイン層**：収支、貸借、支払い方法ごとの集計などのビジネスロジックを集約。  
   - **ユースケース層**：ユーザーの操作（収支入力、返済記録、通知トリガー）を定義。  
   - **API層**：RESTfulまたはtRPCで、フロントと連携するエンドポイントを提供。  
   - **インフラ層**：PostgreSQLとの接続、外部API連携（通知、Google連携）の実装。

3. **UXと拡張性の両立**  
   - **UIはReact**：状態管理とコンポーネント分割により、ユーザー体験を徹底的に改善。  
   - **通知システム**：Googleカレンダー／タスク連携を通じたリマインドを初期から提供。将来的にWeb Pushにも対応予定。  
   - **API統合**：将来的なLLM連携を見越し、APIは拡張可能な設計（ドメイン駆動設計）とする。

4. **既存資産の継承と進化**  
   - GAS時代に培ったTypeScriptコードやドメインロジックは、可能な限り再利用し、無駄なく新システムに取り込む。  
   - 「継承型リプレイス」という観点で、過去の実績を土台に新たな技術スタック（Node/Next/React/PG）に昇華させる。

---

## 🌌 **将来的な展望**

- **AI統合（将来的構想）**：中核となるコンシェルジュアプリの完成後、LLMとの連携によるレポート要約・アドバイス機能を段階的に統合予定。  
  対話型のLive2D UIや音声操作も、将来的な発展領域として構想しているが、現時点では未実装。

- **マルチデバイス／多機能連携**：スマホ、PC、さらにはネイティブアプリとしての展開を視野に、全体のAPI設計を柔軟に保つ。  
- **通知システム**：現時点ではUI主導の管理を前提とし、通知は必須機能ではない。  

---

## ✅ **まとめ**

この設計思想は、**「実用性・拡張性・UXの優先」**というあなたの価値観を基盤に、**型安全・再利用性・責務分離**の原則を徹底し、GAS時代の資産を無駄にせず次世代へと進化させるためのものです。  
最終的には、LLM搭載の美少女コンシェルジュが、あなたの生活全体をスマートに管理する未来へと続く設計の出発点となります。
