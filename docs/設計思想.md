# 📘 `budget_book` 設計思想（ver.1）

---

## 🎯 **目的**

- **自分自身の収支・貸借**を一元的に管理し、
- **必要な通知やUI**を通じて、日々の金銭感覚を整え、
- 将来的に他の**自己管理アプリとも連携**できるような拡張性を持ったシステムを作る。

---

## 🧩 **コード構成方針**

| 項目 | 方針内容 |
| --- | --- |
| **開発環境** | VS Code + TypeScript + clasp（with GAS） |
| **命名規則** | プロジェクト名：`budget_book`収支記録：`entry`貸借管理：`debt` |
| **構成スタイル** | 軽量クリーンアーキテクチャ（app / domain / infrastructure / common） |
| **コード方針** | イベントドリブン主体（`onOpen`, `onEdit`, メニュー操作など） |
| **レコード管理** | **型重視**で `Entry` / `Debt` を定義将来的な変更は**マイグレーション対応** |
| **UI方針** | GAS Web UIを用いてスマホ対応フォームやダッシュボードを構築 |
| **通知** | GASトリガーで定期送信 or イベントベース送信（手動・onEditなど）LINEやSlack対応も将来的に検討 |
| **拡張性** | 機能追加や他自己管理アプリとの**API連携**を見据えて設計 |

---

## 🧱 **アーキテクチャ構成（ディレクトリ）**

```plaintext
コピーする編集する
src/
├── app/              ← エントリポイント（onOpen / メニュー）
├── domain/
│   ├── entry/        ← Entry型定義・バリデーション・ロジック
│   └── debt/         ← Debt型定義・返済計算・状態管理
├── infrastructure/
│   ├── sheet/        ← シート読み書き系（getEntries, updateDebtなど）
│   ├── notify/       ← 通知処理（LINE, Gmail, etc）
│   └── ui/           ← Web UI関連（テンプレ・UI生成）
├── common/
│   ├── constants.ts  ← カラム名や収支タイプなど
│   ├── sheetUtils.ts ← 汎用的なシート操作
│   └── logger.ts     ← ログ出力・エラーハンドリング
├── migrations/       ← レコード構造変更用（バージョン変換など）

```

---

## 🔔 **通知方針（初期構想）**

| イベント | 通知方法（予定） |
| --- | --- |
| 次回返済前日 | GASトリガー + メール or LINE |
| onEditで完済チェック | 完済済みなら通知 or ダッシュボード反映 |
| 手動通知 | メニュー or ボタンから呼び出し |
| その他未払・未回収リマインド | ダッシュボード表示 or 定時通知 |

---

## 📊 **UI構想（GAS Web UI）**

| 機能 | 内容 |
| --- | --- |
| フォームUI | 返済登録 / 借入・貸付登録 / 収支入力など |
| 一覧UI | 借入・貸付の進捗、残高、完済状態一覧 |
| ダッシュボード表示 | 月次収支、未回収一覧、通知履歴など |

---

## 🧬 **マイグレーション構想**

- Entry / Debt の型が変更された場合でもデータを壊さず自動変換
- `migrations/` にバージョンごとのアップグレード関数を保持
- `getEntries()` / `getDebts()` などの読み込み時に適用

---

## 💡 **未来の展望（拡張性）**

- GAS外アプリ（自己管理系ツール）とAPI連携
- クラウドバックアップ or バージョン履歴保存
- 入力補助（テンプレート、カテゴリ予測など）

---

## ✅ 今後の最初のタスク例（順次開発）

1. `Entry` 型（型定義ファイル）作成
2. `validateEntry(entry)` 実装（バリデーション）
3. `getEntries()` 実装（シート読み込み）
4. `validateAllEntries()` メニュー登録
5. `Debt` 側も同様に進行
