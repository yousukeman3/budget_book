# 📘 ドメインルール一覧（budget_book - v2.1）

---

本ドキュメントでは、budget_book に登場する主要ドメインオブジェクトと、それぞれの属性・バリデーション・不変条件を定義する。  
ZodおよびTypeScript型に基づく構造を想定する。

---

## 🧾 Entry（収支記録）

### 用途 - 収支記録

収入・支出・借入・貸付・返済など、すべての金銭の動きを記録する基本単位。  
**借入／貸付は`Debt`と常にセットで生成される。**

### 属性 - 収支記録

| フィールド | 型 | 必須 | 説明 |
|------------|----|------|------|
| `id` | string (UUID) | ✔ | 一意な識別子 |
| `type` | 'income' / 'expense' / 'borrow' / 'lend' | ✔ | 金銭の流れの種別 |
| `date` | string (ISO date) | ✔ | 発生日（YYYY-MM-DD） |
| `amount` | number | ✔ | 金額（正の数） |
| `method` | string | ✔ | 支払い方法（口座名など） |
| `category` | string | ✖ | 任意カテゴリ（支出／収入のみ使用） |
| `memo` | string | ✖ | 任意のメモ |
| `debtId` | string (UUID) | ✖ | 対応するDebtのID（借入／貸付／返済時） |

### 不変条件 - 収支記録

- `amount > 0`
- `type`が`borrow` / `lend`の場合、`debtId`は必須
- `type`が`income` / `expense`で`debtId`がある場合は返済Entry

---

## 💳 Debt（貸借管理）

### 用途 - 貸借管理

借入／貸付の状態管理および進捗の参照。

### 属性 - 貸借管理

| フィールド | 型 | 必須 | 説明 |
|------------|----|------|------|
| `id` | string (UUID) | ✔ | 一意な識別子 |
| `type` | 'borrow' / 'lend' | ✔ | 借入 or 貸付 |
| `entryId` | string (UUID) | ✔ | 起点となるEntryのID |
| `date` | string (ISO date) | ✔ | 発生日 |
| `amount` | number | ✔ | 金額 |
| `counterpart` | string | ✔ | 相手の名前 or 識別情報 |
| `repaidAt` | string (ISO date) | ✖ | 返済完了日（あれば） |
| `memo` | string | ✖ | 任意の備考 |

### 不変条件 - 貸借管理

- `amount > 0`
- `entryId`の`type`は`borrow`または`lend`であること
- `repaidAt`がある場合、`date <= repaidAt`

---

## 💰 Method（支払い手段）

### 用途 - 支払い手段

口座、現金、電子マネーなど、支払い手段を表す。

### 属性 - 支払い手段

| フィールド | 型 | 必須 | 説明 |
|------------|----|------|------|
| `id` | string | ✔ | 一意な識別子（名前で代用も可） |
| `name` | string | ✔ | 表示名 |
| `initialBalance` | number | ✖ | 初期残高（あれば） |
| `archived` | boolean | ✖ | 使用停止フラグ |

---

## 📊 Report（月次レポート）

### 用途 - 月次レポート

月単位の収支集計、method別資産推移、カテゴリ別支出割合などを表示。

### 属性（集計用モデル）

| フィールド | 型 | 説明 |
|------------|----|------|
| `month` | string (YYYY-MM) | 対象月 |
| `totalIncome` | number | 月の総収入 |
| `totalExpense` | number | 月の総支出 |
| `net` | number | 月の収支差分 |
| `methodBalances` | Record<method, number> | 月末時点のmethod別残高 |
| `categoryBreakdown` | Record<category, number> | 支出カテゴリ別合計 |

---

## 🔔 NotificationRule（通知設定）

### 用途 - 通知設定

LINE Notifyやブラウザ通知など、イベントに応じた通知ルール。

### 属性 - 通知設定

| フィールド | 型 | 必須 | 説明 |
|------------|----|------|------|
| `id` | string | ✔ | 通知ルールID |
| `event` | string | ✔ | 通知イベント名（"debt_due", "monthly_summary"など） |
| `channel` | 'line' / 'push' / 'google' | ✔ | 通知先 |
| `timing` | 'immediate' / 'daily' / 'monthly' | ✔ | 通知タイミング |

---

## 🗂️ その他補助ドメイン（カテゴリなど）

- **Category**  
  - `id: string`, `name: string`, `type: 'income' | 'expense'`
  - UI編集可能・型の制限あり
- **UserSetting（将来的な多機能化用）**  
  - `preferredNotification`, `defaultMethod`, `LLMAssistantEnabled` など

---

以上が現時点でのドメイン定義である。
